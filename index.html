<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Fast Lesson Plan Generator – OCR Selected Pages</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<!-- Tesseract OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

<!-- jsPDF + html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
  .hidden { display:none !important; }
</style>
</head>

<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4">

<div class="max-w-4xl mx-auto">

<h1 class="text-4xl font-bold text-center text-indigo-800 mb-2">
  TNSB Lesson Plan Generator
</h1>
<h2 class="text-2xl text-center text-indigo-700 mb-8">
  Fast OCR – Read Only Pages You Need
</h2>


<!-- Status Box -->
<div id="statusBox" class="hidden bg-indigo-100 border border-indigo-400 text-indigo-800 p-4 rounded-lg text-center mb-6">
  Processing...
</div>


<!-- Form -->
<div class="bg-white rounded-2xl shadow-2xl p-8 space-y-8">

  <!-- Upload PDF -->
  <div>
    <label class="block font-bold mb-2">Upload Textbook PDF</label>
    <input type="file" id="pdfFile" accept="application/pdf"
           class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg bg-white" />
  </div>

  <!-- Page Range -->
  <div class="grid grid-cols-2 gap-6">
    <div>
      <label class="block font-bold mb-2">From Page</label>
      <input type="number" id="fromPage" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg" placeholder="e.g., 12">
    </div>

    <div>
      <label class="block font-bold mb-2">To Page</label>
      <input type="number" id="toPage" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg" placeholder="e.g., 18">
    </div>
  </div>

  <button id="runOCR" 
          class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold text-xl py-4 rounded-xl shadow-lg">
    OCR Selected Pages
  </button>

</div>



<!-- RESULT -->
<div id="result" class="hidden mt-12 bg-white rounded-2xl shadow-2xl p-10 border-4 border-indigo-200">

  <h2 class="text-3xl font-bold text-center text-indigo-800 mb-8">Lesson Plan</h2>

  <div id="content" class="text-lg leading-relaxed"></div>

  <div class="text-center mt-12">
    <button onclick="downloadPDF()"
      class="bg-red-600 hover:bg-red-700 text-white font-bold text-xl py-4 px-16 rounded-xl shadow-lg">
      Download as PDF
    </button>
  </div>
</div>

</div>



<script>
/* -------------------------------------------------------------
   Show / Hide Status
------------------------------------------------------------- */
function setStatus(msg) {
  const box = document.getElementById("statusBox");
  if (!msg) {
    box.classList.add("hidden");
    box.textContent = "";
  } else {
    box.classList.remove("hidden");
    box.textContent = msg;
  }
}


/* -------------------------------------------------------------
   FAST OCR: Only Selected Pages
------------------------------------------------------------- */
async function ocrSelectedPages(file, start, end) {
  const pdf = await pdfjsLib.getDocument(URL.createObjectURL(file)).promise;
  let finalText = "";

  for (let p = start; p <= end; p++) {
    setStatus(`Reading page ${p} of ${end}...`);

    const page = await pdf.getPage(p);
    const viewport = page.getViewport({ scale: 1.6 });

    // Render page into a canvas
    const canvas = document.createElement("canvas");
    canvas.width = viewport.width;
    canvas.height = viewport.height;
    await page.render({
      canvasContext: canvas.getContext("2d"),
      viewport
    }).promise;

    // OCR the page (Tamil + English)
    const result = await Tesseract.recognize(canvas, 'tam+eng');
    finalText += "\n" + result.data.text;
  }

  setStatus("");
  return finalText;
}


/* -------------------------------------------------------------
   Convert OCR text → Lesson Plan (Simple but clean)
------------------------------------------------------------- */
function makeLessonPlan(text) {
  const cleaned = text.replace(/\s+/g, " ").trim();

  return `
    <h3 class="text-2xl font-bold text-indigo-700 mb-4">Extracted Text (OCR)</h3>
    <p class="bg-blue-50 p-4 rounded-lg border mb-6">${cleaned}</p>

    <h3 class="text-xl font-bold text-indigo-700">Learning Outcomes</h3>
    <p class="bg-gray-50 p-4 rounded-lg border mb-6">
      • Understand main concepts from the textbook pages.<br>
      • Recall definitions, facts and explanations.<br>
      • Improve reading comprehension using authentic lesson text.<br>
      • Apply the ideas in class discussions and activities.
    </p>

    <h3 class="text-xl font-bold text-indigo-700">Activity</h3>
    <p class="bg-green-50 p-4 rounded-lg border mb-6">
      Read the OCR text. Ask oral questions. Students explain meaning in their own words.
    </p>

    <h3 class="text-xl font-bold text-indigo-700">Homework</h3>
    <p class="bg-yellow-50 p-4 rounded-lg border mb-6">
      Write notes from the extracted text & answer all in-text questions from the textbook.
    </p>

    <h3 class="text-xl font-bold text-indigo-700">Remedial</h3>
    <p class="bg-purple-50 p-4 rounded-lg border mb-6">
      Provide simplified explanations of the important sentences extracted through OCR.
    </p>
  `;
}


/* -------------------------------------------------------------
   Handle OCR Button Click
------------------------------------------------------------- */
document.getElementById("runOCR").addEventListener("click", async () => {
  const file = document.getElementById("pdfFile").files[0];
  const fromPage = parseInt(document.getElementById("fromPage").value);
  const toPage = parseInt(document.getElementById("toPage").value);

  if (!file) return alert("Please upload textbook PDF");
  if (!fromPage || !toPage) return alert("Enter valid page range");
  if (fromPage > toPage) return alert("From Page must be ≤ To Page");

  setStatus("Starting OCR... Please wait");

  const text = await ocrSelectedPages(file, fromPage, toPage);

  document.getElementById("content").innerHTML = makeLessonPlan(text);
  document.getElementById("result").classList.remove("hidden");
  document.getElementById("result").scrollIntoView({ behavior: "smooth" });

  setStatus("");
});


/* -------------------------------------------------------------
   Download PDF
------------------------------------------------------------- */
function downloadPDF() {
  const { jsPDF } = window.jspdf;

  html2canvas(document.getElementById("content"), { scale: 2 }).then(canvas => {
    const pdf = new jsPDF('p', 'mm', 'a4');
    const width = pdf.internal.pageSize.getWidth();
    const height = (canvas.height * width) / canvas.width;

    pdf.addImage(canvas.toDataURL("image/png"), "PNG", 0, 0, width, height);
    pdf.save("LessonPlan_SelectedPages.pdf");
  });
}

</script>

</body>
</html>
