<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TNSB Lesson Plan Generator – OCR Selected Pages</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<!-- Tesseract OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

<!-- jsPDF + html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>.hidden { display:none !important; }</style>
</head>

<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4">
<div class="max-w-4xl mx-auto">

<h1 class="text-4xl font-bold text-center text-indigo-800 mb-1">Tamil Nadu State Board</h1>
<h2 class="text-2xl text-center text-indigo-700 mb-6">Lesson Plan Generator (OCR Selected Pages)</h2>

<div id="statusBox" class="hidden bg-indigo-100 border border-indigo-400 text-indigo-800 p-4 rounded-lg text-center mb-6">
  Processing...
</div>

<!-- FORM SECTION -->
<div class="bg-white rounded-2xl shadow-2xl p-8 space-y-8">

  <div class="grid md:grid-cols-3 gap-6">
    <div>
      <label class="block font-bold mb-2">Subject</label>
      <input id="subject" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="English" />
    </div>
    <div>
      <label class="block font-bold mb-2">Class</label>
      <input id="class" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="10" />
    </div>
    <div>
      <label class="block font-bold mb-2">Section</label>
      <input id="section" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="A" />
    </div>
  </div>

  <div class="grid md:grid-cols-3 gap-6">
    <div>
      <label class="block font-bold mb-2">Unit</label>
      <input id="unit" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="Unit 3" />
    </div>
    <div>
      <label class="block font-bold mb-2">Lesson Title</label>
      <input id="title" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="Heat" />
    </div>
    <div>
      <label class="block font-bold mb-2">Author (Optional)</label>
      <input id="author" class="w-full px-4 py-3 border-2 rounded-lg" placeholder="Author Name" />
    </div>
  </div>

  <div>
    <label class="block font-bold mb-2">Week / Dates</label>
    <input id="dates" value="02/12/2025 - 06/12/2025" class="w-full px-4 py-3 border-2 rounded-lg" />
  </div>

  <div>
    <label class="block font-bold mb-2">Upload Textbook PDF</label>
    <input type="file" id="pdfFile" accept="application/pdf"
           class="w-full px-4 py-3 border-2 rounded-lg bg-white" />
  </div>

  <div class="grid grid-cols-2 gap-6">
    <div>
      <label class="block font-bold mb-2">From Page</label>
      <input type="number" id="fromPage" class="w-full px-4 py-3 border-2 rounded-lg" />
    </div>
    <div>
      <label class="block font-bold mb-2">To Page</label>
      <input type="number" id="toPage" class="w-full px-4 py-3 border-2 rounded-lg" />
    </div>
  </div>

  <button id="runOCR"
    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold text-xl py-4 rounded-xl shadow-lg">
    OCR Selected Pages & Generate Lesson Plan
  </button>

</div>

<!-- OUTPUT -->
<div id="result" class="hidden mt-12 bg-white rounded-2xl shadow-2xl p-10 border-4 border-indigo-200">
  <h2 class="text-3xl font-bold text-center text-indigo-800 mb-6">Lesson Plan</h2>
  <div id="content" class="text-lg leading-relaxed"></div>

  <div class="text-center mt-12">
    <button onclick="downloadPDF()"
      class="bg-red-600 hover:bg-red-700 text-white font-bold text-xl py-4 px-16 rounded-xl shadow-lg">Download PDF</button>
  </div>
</div>

</div>

<script>

/* STATUS DISPLAY */
function setStatus(msg){
  const box=document.getElementById("statusBox");
  if(!msg){ box.classList.add("hidden"); }
  else { box.classList.remove("hidden"); box.textContent=msg; }
}

/* OCR SELECTED PAGES */
async function ocrSelectedPages(file,start,end){
  const pdf = await pdfjsLib.getDocument(URL.createObjectURL(file)).promise;
  let text="";

  for(let p=start; p<=end; p++){
    setStatus(`Reading Page ${p} of ${end}...`);
    const page=await pdf.getPage(p);
    const vp=page.getViewport({scale:1.6});
    const canvas=document.createElement("canvas");
    canvas.width=vp.width; canvas.height=vp.height;
    await page.render({canvasContext:canvas.getContext("2d"),viewport:vp}).promise;

    const result=await Tesseract.recognize(canvas,"tam+eng");
    text+=result.data.text+"\n";
  }

  setStatus("");
  return text;
}

/* LESSON PLAN BUILDER */
function buildLessonPlan(rawText) {

  // Gist = first ~120 words from OCR text
  const gist = rawText.replace(/\s+/g, " ").trim().split(" ").slice(0, 120).join(" ");

  return `
  <div class="space-y-8">

    <!-- 1. ESSENTIALS -->
    <div>
      <h3 class="text-xl font-bold text-indigo-700">1. Subject, Class, Section, Dates</h3>
      <p>
        <b>Subject:</b> ${subject.value}<br>
        <b>Class:</b> ${class.value} &nbsp;&nbsp; <b>Section:</b> ${section.value}<br>
        <b>Dates:</b> ${dates.value}
      </p>
    </div>

    <!-- 2. UNIT, TITLE -->
    <div>
      <h3 class="text-xl font-bold text-indigo-700">2. Unit, Title, Author</h3>
      <p>
        <b>Unit:</b> ${unit.value}<br>
        <b>Title:</b> ${title.value}<br>
        <b>Author:</b> ${author.value || "Textbook Author"}
      </p>
    </div>

    <!-- 3. NATURE OF LESSON -->
    <div>
      <h3 class="text-xl font-bold text-indigo-700">3. Nature of the Lesson</h3>
      <p>
        (i) Stand Alone / Building Blocks / Tree & Branches<br>
        (ii) Format: 40 Minutes
      </p>
    </div>

    <!-- 4. LEARNING OUTCOMES -->
    <div>
      <h3 class="text-xl font-bold text-indigo-700">4. Learning Outcomes</h3>
      <p>
        • Understand the ideas explained in the lesson.<br>
        • Recall facts, definitions and examples accurately.<br>
        • Improve reading comprehension using textbook content.<br>
        • Apply knowledge in activities and discussions.<br>
        • Develop higher-order thinking skills.
      </p>
    </div>

    <!-- 5. METHODOLOGY -->
    <div>
      <h3 class="text-xl font-bold text-indigo-700">5. Methodology</h3>
      <p>Interactive / Explanatory / Demonstrative / Do & Learn / Playway</p>
    </div>

    <!-- 6. TEACHING AIDS -->
    <div>
      <h3 class="text-xl font-bold text-indigo-700">6. Teaching Aids</h3>
      <p>Textbook, Blackboard, Charts, Flash cards, Digital aids (optional)</p>
    </div>

    <!-- 7. GIST -->
    <div>
      <h3 class="text-xl font-bold text-indigo-700">7. Content / Gist of the Lesson</h3>
      <p>${gist}</p>
    </div>

    <!-- 8. ACTIVITIES -->
    <div>
      <h3 class="text-xl font-bold text-indigo-700">8. Activities Planned</h3>

      <p><b>Motivation:</b> Short oral questions based on prior knowledge.</p>

      <h4 class="font-semibold text-indigo-700 mt-3">Choose any ONE of the following patterns:</h4>

      <!-- Listening/Speaking -->
      <p class="mt-2">
        <b>Option A: For Listening / Speaking</b><br>
        (i) Brain storming<br>
        (ii) Pair work<br>
        (iii) Presentation
      </p>

      <!-- Reading -->
      <p class="mt-2">
        <b>Option B: For Reading (Prose / Poem / Supplement)</b><br>
        (i) Pre-reading activities<br>
        (ii) While-reading activities<br>
        (iii) Post-reading activities
      </p>

      <!-- Lesson -->
      <p class="mt-2">
        <b>Option C: For Lesson (Content Teaching)</b><br>
        (i) Consolidation<br>
        (ii) Reinforcement<br>
        (iii) Enrichment
      </p>

      <!-- Writing -->
      <p class="mt-2">
        <b>Option D: For Writing</b><br>
        (i) Hints / points / scaffolding<br>
        (ii) Group work<br>
        (iii) Presentation
      </p>

      <!-- Grammar -->
      <p class="mt-2">
        <b>Option E: For Grammar</b><br>
        (i) Explain the rules<br>
        (ii) Give examples<br>
        (iii) Invite more examples from students
      </p>
    </div>

    <!-- 9. WEEKEND ACTIVITY -->
    <div>
      <h3 class="text-xl font-bold text-indigo-700">9. Week-end Activity</h3>
      <p>
        Students prepare a short note, diagram, mind-map or summary based on the topic.
      </p>
    </div>

    <!-- 10. REMEDIAL -->
    <div>
      <h3 class="text-xl font-bold text-indigo-700">10. Remedial Action</h3>
      <p>
        Re-teach difficult points with simpler examples.<br>
        Provide peer support & additional practice.
      </p>
    </div>

  </div>
  `;
}

/* MAIN CLICK */
document.getElementById("runOCR").addEventListener("click", async ()=>{
  const file=pdfFile.files[0];
  const fp=parseInt(fromPage.value);
  const tp=parseInt(toPage.value);

  if(!file || !fp || !tp){ alert("Fill all fields"); return; }

  const raw = await ocrSelectedPages(file,fp,tp);

  content.innerHTML = buildLessonPlan(raw);
  result.classList.remove("hidden");
  result.scrollIntoView({behavior:"smooth"});
});

/* PDF DOWNLOAD */
function downloadPDF(){
  const {jsPDF}=window.jspdf;
  html2canvas(content,{scale:2}).then(canvas=>{
    const pdf=new jsPDF('p','mm','a4');
    const w=pdf.internal.pageSize.getWidth();
    const h=(canvas.height*w)/canvas.width;
    pdf.addImage(canvas.toDataURL("image/png"),"PNG",0,0,w,h);
    pdf.save("LessonPlan.pdf");
  });
}

</script>

</body>
</html>
